{% extends "base.html" %}

{% load bootstrap3 %}
{% load bootstrap_dynamic_formsets %}

{% block content %}

<div class="alert alert-info">
  Bulk addition of samples for study:<br>
  {{ request.session.adding_study.name }}
</div>


{% if existing_samples %}
<div class="alert alert-warning">
  <strong>The following samples found in file(s) have been previously uploaded and are not shown in upload grid below</strong>
  <ul>
    {% for sample in existing_samples %}
      <li>{{ sample }}</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<form method="post" action="">
  {% csrf_token %}
  {% bootstrap_dynamic_formset formset can_order=True can_delete=True layout="horizontal" %}
  {% bootstrap_button "Save" button_type="submit" button_class="btn-primary" %}
  <a class="btn btn-default" href="{% url 'tp:experiments' %}">Cancel</a>
</form>
<script>
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}
async function get_sampleorder(){
 await sleep(100);
var samples = $("[id$=sample_name]");
  var sample = []
  for(var x =0; x < samples.length; x++){
  sample.push(samples[x]["value"]);
  }
  for(var x=0; x<sample.length; x++){
  item = $(':input[value="'+sample[x]+'"]').attr('name');
  item = item.replace("sample_name","order");
  $(':input[name="'+item+'"]').val(x);
  }
}
$(".up-form-form").click(function(){
  get_sampleorder();
  });
$(".down-form-form").click(function(){
  get_sampleorder();
  });
  $(function() {
   $('input[type=number]').attr("readonly","readonly");
  get_sampleorder();

  });

</script>
{% endblock content %}
